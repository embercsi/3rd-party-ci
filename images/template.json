{
    "variables": {
        "centos": "7",
        "contents": "base"
    },
    "description": "Ember-CSI 3rd party CI job CentOS {{user `centos`}} {{user `contents`}} image",
    "builders": [
        {
            "type": "vagrant",
            "output_dir": "output",
            "source_path": "centos/{{user `centos`}}",
            "box_version": "2020.01",
            "provider": "libvirt",
            "add_force": true,
            "box_name": "ember-centos-{{user `centos`}}-{{user `contents`}}",
            "teardown_method": "destroy",
            "communicator": "ssh"
        }
    ],
    "provisioners": [
        {
            "type": "shell",
            "inline":["mkdir /tmp/{scripts,data}"]
        },
        {
            "type": "file",
            "source": "./data/",
            "destination": "/tmp/data"
        },
        {
            "type": "shell",
            "inline":["sudo cp -prH /tmp//data/centos{{user `centos`}}/{{user `contents`}}/. /"]
        },
        {
            "type": "file",
            "source": "./scripts/",
            "destination": "/tmp/scripts"
        },
        {
            "type": "shell",
            "script": "./scripts/run.sh",
            "remote_path": "/tmp/run.sh",
            "environment_vars": [
                "SCRIPTS_LOCATION=/tmp/scripts/centos{{user `centos`}}/{{user `contents`}}"
            ]
        },
        {
            "type": "shell",
            "inline":["sudo sync"]
        }
    ]
}
